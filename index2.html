<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Add an icon to the map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>

<script>
	// TO MAKE THE MAP APPEAR YOU MUST
	// ADD YOUR ACCESS TOKEN FROM
	// https://account.mapbox.com
	mapboxgl.accessToken = 'pk.eyJ1IjoiZm12YWxkZXpnODQiLCJhIjoiY2w5eWJzMzkwMDNiaDNvbGltamV1ajdvNiJ9.esyugI1HyBVPAQcRN551xw';
    const map = new mapboxgl.Map({
        container: 'map', // container ID
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'mapbox://styles/mapbox/dark-v11', // style URL
        zoom: 12, // starting zoom
        center: [-75.1405, 39.9839] // starting position
    });

    map.on('load', () => {
        // Define an array of image URLs
        const imageUrls = [
        'https://raw.githubusercontent.com/fmvaldezg/PCWmap/main/icons/high_sites.png',
        'https://raw.githubusercontent.com/fmvaldezg/PCWmap/main/icons/icon1.png',
        ];

        // Define an object to store the loaded images
        const images = {};

        // Loop through the image URLs and load each image
        imageUrls.forEach(url => {
        map.loadImage(url, (error, image) => {
            if (error) throw error;

        // Add the loaded image to the images object
        images[url] = image;

    // Check if all images have been loaded
        if (Object.keys(images).length === imageUrls.length) {
        // All images have been loaded, so add them to the map style
        for (const [name, image] of Object.entries(images)) {
            map.addImage(name, image);
        }

      // Add a data source containing point features with different icon images
                map.addSource('points', {
                    'type': 'geojson',
                    'data': 'https://raw.githubusercontent.com/fmvaldezg/PCWmap/main/data/high_sites.geojson'
                });

                // Add a layer to use the different images to represent the data.
                map.addLayer({
                    'id': 'high_sites',
                    'type': 'symbol',
                    'source': 'points',
                    'layout': {
                    'icon-image': ['match', ['get', 'icon'], ...Object.keys(images)],
                    'icon-size': 2
                    }
                });
    }
  });
});

});
</script>

</body>
</html>
